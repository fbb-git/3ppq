1.  Directory organization
2.  Psychologist FSA
3.  Webserver requirements
4.  New FSA diagram

1. Directory organization
=========================

${basePath} - directory below which all files of the project are stored.
              In ${basePath} run ./preparebase to prepare all directories +
              required permissions.

${webRoot}  - directory defined as DocumentRoot in the
              apache2/sites-enabled/xxx file
              ${webRoot}  could be a link to ${basePath}/www

In ${basePath}
    
    bin/        x.www-data, g+rx
                directory containing the form-program. May be accessed via a
                soft link

    js/         JavaScript support files: scripts called from webpages/stubs

    css/        project CSS file

    data/       data files created by form

    stubs/      html stub files

    images/     images included by stubs-files and html files

    www/        html files. ${webRoot} links to this directory


Other directories and files are entries used during development

    
README              - this file
changelog           - project changelog file 
doc                 -   documentation in Yodl and html formats
form/               - source files of the form-handling program
gnuplot             - demo configuration of gnuplot producing line-plots
icmconf.programs    - icmconf file shared by programs
log                 - log file
setup               - initial libreoffice-impress .odp file containing the
                        general project description
src                 - source files of related programs
support             - source files of the support library
VERSION             - link to form/VERSION


2. Psychologist FSA
===================

start, psych and client are pseudo states: reached by loading the /index.html,
/psych.html or /client.html www pages

all Psych states also define type=psych
all Client states also define type=client

By passing a variable as hidden value the receiving html page receives it. It may be retrieved using
document.getElementsByName("nip")[0].value;



----------------------------------------------------------------------------------------------------------------------------------------
                            Psych-fun or                                                        
state       invars          wwww/ file          html-file       js              out-vars        next state      description
----------------------------------------------------------------------------------------------------------------------------------------
start       -               /index.html         -               -               -               psych           
                                                                                                client
----------------------------------------------------------------------------------------------------------------------------------------
psych       -               /psych.html         -               psych           nip,pwd         verify          verify UN/PW
                                                                                                noPwd           new Pwd sent by mail
                                                                                                signup          sign up as NIP user
                                                                                                
verify      nip,pwd         verify()            unknownpsych    unknownpsych    -               start           user cancels
                                                                                                signup          user signs up
                                                pwdfailure      -               -               psych           user tries again
                                                                                                start           user cancels
                                                verify          -               ack,nip,pwd     verifyAck       user's ack nr is verified
                                                actions         -               nip             actions

actions     nip             client()            client                       
                                                                                                
noPwd                       noPwd()             nopwd           -               -               start           continuation option
                                                                                                psych           same
                                                                
signup                      /signup.html        -               signup          name,lastName,  tryAdd          try to add new user
                                                                                gender,email,   
                                                                                pwd             
                                                                
tryAdd      name,lastname,  tryAdd()                            
            gender,email,     acceptSignup()    acceptsignup    -               -               psych           login after signing up
            pwd                                 rejectsignup    -               -               signup          try again
                                                                                                psych           try to login again
                                                                                                start           user cancels

verifyAck   ack,nip,pwd     verifyAck()         actions         -               -               start (wip)     TODO
                                                ackerr          -               nip,pwd         start           user cancels
                                                                                                verify          try again after ack error
                                                                                -               
----------------------------------------------------------------------------------------------------------------------------------------
client      -               /client.html        -               client          ack             verify          verify ack

verify      ack             verify()            unknownclient   -               -               start           client cancels
                                                                -               -               client          try again
                                                                                id              instruct        questionnaire instr.
instruct    id              -                   -               

quest       id,nr           quest()             quest           quest           id,nr           quest           present questions
                                                thanks                                          start           end of questions
----------------------------------------------------------------------------------------------------------------------------------------



3. Web server requirements
==========================

    Define webRoot  /var/www/html/psycho
    Define basePath /home/frank/src/psycho/website

    Alias /css             ${basePath}/css
    Alias /js              ${basePath}/js
    Alias /images          ${basePath}/images
    ScriptAlias /bin       ${basePath}/bin

        # links to {basePath}/www/
    <Directory "/var/www/psycho" >
    Require all granted
       Options Indexes FollowSymLinks MultiViews Includes ExecCGI    
    </Directory>
 
    <Directory "${basePath}/images" >
       Require all granted
    </Directory>

    <Directory "${basePath}/css" >
       Require all granted
    </Directory>

    <Directory "${basePath}/js" >
       Require all granted
       Options Includes
    </Directory>

    <Directory "${basePath}/bin" >
    Require all granted
       Options FollowSymLinks ExecCGI    
    </Directory>
 

4. New FSA diagram
==================

In all cases where an unknown nip is passed to a function while the nip value
should be known the /home page is opened. Where /home is mentioned an explicit
request to open the home-page is provided.

------------------------------------------------------------------------
            cgi         handler     next    
html        vars        (function)  html        xfer    descr
------------------------------------------------------------------------
/psych      nip,pwd     verify      action      nip     nip/pwd OK
                                    newPwd      nip     new pwd by mail
                                    ackCheck    nip     ack verification
                                    /noPsych       
                                    /home
                        /register 

/noPsych                /home
                        /register

/register   nip,pwd,    newPsych    knownPsych          already registered
            name, etc.
                                    ackCheck    nip     ack verification


knownPsych              /register                       try again
                        /home


newPwd                  /psych                          login again

ackCheck    nip         ackCheck    /psych              ack set to 0
                                    ackError    nip

ackError    nip         ackCheck


action      nip         /client                 nip     actions with clients
                        /profile                nip     change profile

/client     nip         newClient   newClient   nip     define new client


newClient   nip         /client                         












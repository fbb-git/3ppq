1.  Directory organization
3.  Webserver requirements
4.  New FSA diagram

1. Directory organization
=========================

${basePath} - directory below which all files of the project are stored.
              In ${basePath} run ./preparebase to prepare all directories +
              required permissions.

${webRoot}  - directory defined as DocumentRoot in the
              apache2/sites-enabled/xxx file
              ${webRoot}  could be a link to ${basePath}/www

In ${basePath}
    
    bin/        x.www-data, g+rx
                directory containing the form-program. May be accessed via a
                soft link

    js/         JavaScript support files: scripts called from webpages/stubs

    css/        project CSS file

    data/       data files created by form

    stubs/      html stub files

    images/     images included by stubs-files and html files

    www/        html files. ${webRoot} links to this directory


Other directories and files are entries used during development

    
README              - this file
changelog           - project changelog file 
doc                 -   documentation in Yodl and html formats
form/               - source files of the form-handling program
gnuplot             - demo configuration of gnuplot producing line-plots
icmconf.programs    - icmconf file shared by programs
log                 - log file
setup               - initial libreoffice-impress .odp file containing the
                        general project description
src                 - source files of related programs
support             - source files of the support library
VERSION             - link to form/VERSION



3. Web server requirements
==========================

    Define webRoot  /var/www/html/psycho
    Define basePath /home/frank/src/psycho/website

    Alias /css             ${basePath}/css
    Alias /js              ${basePath}/js
    Alias /images          ${basePath}/images
    ScriptAlias /bin       ${basePath}/bin

        # links to {basePath}/www/
    <Directory "/var/www/psycho" >
    Require all granted
       Options Indexes FollowSymLinks MultiViews Includes ExecCGI    
    </Directory>
 
    <Directory "${basePath}/images" >
       Require all granted
    </Directory>

    <Directory "${basePath}/css" >
       Require all granted
    </Directory>

    <Directory "${basePath}/js" >
       Require all granted
       Options Includes
    </Directory>

    <Directory "${basePath}/bin" >
    Require all granted
       Options FollowSymLinks ExecCGI    
    </Directory>
 

4. New FSA diagram
==================

In all cases where an unknown nip is passed to a function while the nip value
should be known the /home page is opened. Where /home is mentioned an explicit
hyperlink for opening the home-page is provided.

.h files are html file generated from the website/html directory.

xferred = means: received vars are all transferred to the next element

T: to do, W: WIP

18: increment BEFORE defining a state
    (this is the LAST USED state number)
    prefix W to indicate: available, but under construction.

Home page:  
==========
=============================================================================
                         CGI-vars          
   function/       --------------------
   html            received    xferred     next        descr
-----------------------------------------------------------------------------
 1 /home           -           -         2 /psych      psychologists entry pt
   
                               -           /client     client entry pt
   
                               -         3 /register   psych. registration
=============================================================================
   
   
Psych FSA:
==========
=============================================================================
                         CGI-vars          
   function/       --------------------
   html            received     xferred     next            descr
------------------------------------------------------------------------------
 2 /psych          -            email,    4 verify
                                pwd, 
                                mode: 
                                noPwd,login
                                
                                -         3 /register       register   
-----------------------------------------------------------------------------
 3 /register        -           nip,pwd,  8 addPsych        new registration
                                name,etc.               
                                          1 /home
------------------------------------------------------------------------------
 4 verify          email,       -         5 notregistered.h unknown email
                   mode,pwd               
                                email     6 confirmnewpwd.h request new pwd
                                          
                                -         7 pwderror.h      incorrect pwd
                                          
                                =        12 requestack.h    ack is nonzero
                                
                                          
                                email   W17 actions.h       login OK
-----------------------------------------------------------------------------
 5 notregistered.h -            -         2 /psych          login
   
                                -         3 /register       register
                                           
                                -         1 /home
-----------------------------------------------------------------------------
 6 confirmnewpwd.h email        -         2 /psych      try again to login
   
                                email    15 newPwd      change the pwd
-----------------------------------------------------------------------------
 7 pwderror.h       -           -         2 /psych      try again
   
                                -         1 /home
-----------------------------------------------------------------------------
 8 addPsych     -   nip,pwd               9 knownpsych.h    already registered
                    name,etc.   
                                         10 rejectpsych.h   invalid data  
                    
                                email    11 ackcheck.h  registered: verify ack
------------------------------------------------------------------------------
 9 knownpsych.h     -           -         3 /register   try again to register
                    
                                          2 /psych      or login
                    
                                -         1 /home
------------------------------------------------------------------------------
10 rejectpsych.h    -           -         3 /register   try again to register
                    
                                -         1 /home
------------------------------------------------------------------------------
11 ackcheck.h       -           -         2 /psych
                    
                                -         1 /home
------------------------------------------------------------------------------
12 requestack.h     email,mode  =,ack    13 verifyAck
                    pwd
-----------------------------------------------------------------------------
13 verifyAck       email,ack    email    17 actions.h   ack OK: reset to 0
                   mode,pwd                             pass messages

                                email    14 ackerror.h  ack error
                                mode,pwd
-----------------------------------------------------------------------------
14 ackerror.h       email,mode  =         4 verify      try again
                    pwd
                                          1 /home
------------------------------------------------------------------------------
15 newPwd          email        -        16 newpwd.h    info: newpwd by mail
-----------------------------------------------------------------------------
16 newpwd.h         -           -         2 /psych      login again
   
                                -         1 /home
   
-----------------------------------------------------------------------------
17 actions.h    -   email       =           action      pass on action req.
                 

------------------------------------------------------------------------------
   action       -   email       =           client.h    client-related actions
                    
                                =        18 profile.h   change own data       
                    
                                =           data.h      handle collected data 
                    
                                =           contact.h   contact the 3ppq team 
------------------------------------------------------------------------------
   client.h     -   email       =        18 profile.h   change own data       
                    
                                =           data.h      handle collected data 
                    
                                =           contact.h   contact the 3ppq team 
                    
                                =,          newClient   define new client
                                client-data         
------------------------------------------------------------------------------
18 profile.h    -   email       =           client.h    client-related actions
                        
                                =           data.h      handle collected data 
                    
                                =           contact.h   contact the 3ppq team 

                                =,
                                new data    profile     process the new
                                                        profile data

                                =           /home
------------------------------------------------------------------------------
   profile      -   new data,   -           /psych      login again
                    email
                                =           proferr.h   error in new data
------------------------------------------------------------------------------
   proferr.h    -   new data,   =           /psych      login again
                    email
                                email    18 profile.h   change own data

                                =           /home
------------------------------------------------------------------------------
   contact.h    -   email       =           client.h    client-related actions
                    
                                =        18 profile.h   change own data       
                    
                                =           data.h      handle collected data 
------------------------------------------------------------------------------
   data.h       -   email       =           client.h    client-related actions
                    
                                =        18 profile.h   change own data
                    
                                =           contact.h   contact the 3ppq team 
------------------------------------------------------------------------------
   newClient    -   nip,        email       clexists.h  client exists, 
                    client-data                         try again
                    
                                email       client.h                
------------------------------------------------------------------------------
   clexists.h   -   email       =           client.h    
==============================================================================
                    
                    
Client FSA:         
===========         
==============================================================================
                          CGI-vars          
   function/        --------------------
   html        OK   received    produced    next        descr
------------------------------------------------------------------------------
   /client      -    -          login1,     verify      client logs in
                                login2
------------------------------------------------------------------------------
   verify       -   login1,     -           /noclient   login codes unkown
                    login2       
                    
                                =           others.h    provide e-mail for 
                                                        others
                    
                             ====,          instruct.h  provide instruction
                                variables,
------------------------------------------------------------------------------
   others.h     -   login1,  ====,          others      store e-mail
                    login2,     3 x e-mail
------------------------------------------------------------------------------
   others       -   login1,     login1,     instruct.h  provide instruction
                    login2,     login2,                 (e-mail ignored if 
                    3 x e-mail                          already specified)
------------------------------------------------------------------------------
   instruct.h   -   login1,  ====,          quest       present questions
                    login2,     nr,data,
                    variables,            
                                
------------------------------------------------------------------------------
   quest        -   login1,     =           quest.h
                    login2      
                    variables,  
                    nr,data     
                    
                                =           complete.h
------------------------------------------------------------------------------
   quest.h      -   login1,     =           quest
                    login2      
                    variables,  
                    nr,data     
------------------------------------------------------------------------------
   complete.h   -   login1,     =           quest
                    login2      
                    variables,  
                    nr,data     
                    
                                =           thanks
------------------------------------------------------------------------------
   thanks       -   login1,     -         1 /home
                    login2    
                    variables,
                    nr,data   
------------------------------------------------------------------------------
   /noclient    -   -           -           /client     try again
                                         1 /home
=============================================================================

1.  Directory organization
2.  Psychologist FSA
3.  Webserver requirements
4.  New FSA diagram

1. Directory organization
=========================

${basePath} - directory below which all files of the project are stored.
              In ${basePath} run ./preparebase to prepare all directories +
              required permissions.

${webRoot}  - directory defined as DocumentRoot in the
              apache2/sites-enabled/xxx file
              ${webRoot}  could be a link to ${basePath}/www

In ${basePath}
    
    bin/        x.www-data, g+rx
                directory containing the form-program. May be accessed via a
                soft link

    js/         JavaScript support files: scripts called from webpages/stubs

    css/        project CSS file

    data/       data files created by form

    stubs/      html stub files

    images/     images included by stubs-files and html files

    www/        html files. ${webRoot} links to this directory


Other directories and files are entries used during development

    
README              - this file
changelog           - project changelog file 
doc                 -   documentation in Yodl and html formats
form/               - source files of the form-handling program
gnuplot             - demo configuration of gnuplot producing line-plots
icmconf.programs    - icmconf file shared by programs
log                 - log file
setup               - initial libreoffice-impress .odp file containing the
                        general project description
src                 - source files of related programs
support             - source files of the support library
VERSION             - link to form/VERSION


2. Psychologist FSA
===================

start, psych and client are pseudo states: reached by loading the /index.html,
/psych.html or /client.html www pages

all Psych states also define type=psych
all Client states also define type=client

By passing a variable as hidden value the receiving html page receives it. It may be retrieved using
document.getElementsByName("nip")[0].value;



----------------------------------------------------------------------------------------------------------------------------------------
                            Psych-fun or                                                        
state       invars          wwww/ file          html-file       js              out-vars        next state      description
----------------------------------------------------------------------------------------------------------------------------------------
start       -               /index.html         -               -               -               psych           
                                                                                                client
----------------------------------------------------------------------------------------------------------------------------------------
psych       -               /psych.html         -               psych           nip,pwd         verify          verify UN/PW
                                                                                                noPwd           new Pwd sent by mail
                                                                                                signup          sign up as NIP user
                                                                                                
verify      nip,pwd         verify()            unknownpsych    unknownpsych    -               start           user cancels
                                                                                                signup          user signs up
                                                pwdfailure      -               -               psych           user tries again
                                                                                                start           user cancels
                                                verify          -               ack,nip,pwd     verifyAck       user's ack nr is verified
                                                actions         -               nip             actions

actions     nip             client()            client                       
                                                                                                
noPwd                       noPwd()             nopwd           -               -               start           continuation option
                                                                                                psych           same
                                                                
signup                      /signup.html        -               signup          name,lastName,  tryAdd          try to add new user
                                                                                gender,email,   
                                                                                pwd             
                                                                
tryAdd      name,lastname,  tryAdd()                            
            gender,email,     acceptSignup()    acceptsignup    -               -               psych           login after signing up
            pwd                                 rejectsignup    -               -               signup          try again
                                                                                                psych           try to login again
                                                                                                start           user cancels

verifyAck   ack,nip,pwd     verifyAck()         actions         -               -               start (wip)     TODO
                                                ackerr          -               nip,pwd         start           user cancels
                                                                                                verify          try again after ack error
                                                                                -               
----------------------------------------------------------------------------------------------------------------------------------------
client      -               /client.html        -               client          ack             verify          verify ack

verify      ack             verify()            unknownclient   -               -               start           client cancels
                                                                -               -               client          try again
                                                                                id              instruct        questionnaire instr.
instruct    id              -                   -               

quest       id,nr           quest()             quest           quest           id,nr           quest           present questions
                                                thanks                                          start           end of questions
----------------------------------------------------------------------------------------------------------------------------------------



3. Web server requirements
==========================

    Define webRoot  /var/www/html/psycho
    Define basePath /home/frank/src/psycho/website

    Alias /css             ${basePath}/css
    Alias /js              ${basePath}/js
    Alias /images          ${basePath}/images
    ScriptAlias /bin       ${basePath}/bin

        # links to {basePath}/www/
    <Directory "/var/www/psycho" >
    Require all granted
       Options Indexes FollowSymLinks MultiViews Includes ExecCGI    
    </Directory>
 
    <Directory "${basePath}/images" >
       Require all granted
    </Directory>

    <Directory "${basePath}/css" >
       Require all granted
    </Directory>

    <Directory "${basePath}/js" >
       Require all granted
       Options Includes
    </Directory>

    <Directory "${basePath}/bin" >
    Require all granted
       Options FollowSymLinks ExecCGI    
    </Directory>
 

4. New FSA diagram
==================

In all cases where an unknown nip is passed to a function while the nip value
should be known the /home page is opened. Where /home is mentioned an explicit
hyperlink for opening the home-page is provided.

.h files are html file generated from the website/html directory.

xferred = means: received vars are all transferred to the next element


Home page:
==========
============================================================================
                      CGI-vars          
function/       --------------------
html        OK  received    xferred     next        descr
----------------------------------------------------------------------------
/home        +  -           -           /psych      psychologists entry

                            -           /client     client entry

                            -           /register   psych. registration
============================================================================


Psych FSA:
==========
============================================================================
                      CGI-vars          
function/       --------------------
html        OK  received    xferred     next        descr
----------------------------------------------------------------------------
/psych       +  -           e-mail,     verify
                            pwd, mode

                            -           /register   register   
----------------------------------------------------------------------------
verify       W  email,      -           /noPsych    unknown NIP
                mode,pwd    
                            nip         /newPwd     request new pwd

                            nip         ackCheck.h  ack nonzero: enter ack

                            nip         action.h    login OK
----------------------------------------------------------------------------
/noPsych     -  -           -           /home       back home

                            -           /register   try to register
----------------------------------------------------------------------------
/newPwd      -  -           -           /psych      new pwd sent to e-mail
----------------------------------------------------------------------------
ackCheck.h   -  nip         =           ackCheck    
----------------------------------------------------------------------------
ackCheck     -  nip         =           action.h    ack OK: reset to 0

                            =           ackError.h  ack error
----------------------------------------------------------------------------
ackError.h   -  nip         =           ackCheck.h  try again
----------------------------------------------------------------------------
/register    -  -           nip,pwd,    addPsych    register as new psych.
                            name,etc.               
----------------------------------------------------------------------------
addPsych     -  nip,pwd                 knownPsych.halready registered
                name,etc.   

                            nip         ackCheck.h  registered: verify ack
----------------------------------------------------------------------------
knownPsych.h -  -           -           /register   try again to register

                            -           /home       back home
----------------------------------------------------------------------------
action.h     -  nip         =           client.h    client-related actions  

                            =           profile.h   change own data         

                            =           data.h      handle collected data   

                            =           contact.h   contact the 3ppq team   
----------------------------------------------------------------------------
client.h     -  nip         =           profile.h   change own data         

                            =           data.h      handle collected data   

                            =           contact.h   contact the 3ppq team   

                            =,          newClient   define new client
                            client-data         
----------------------------------------------------------------------------
profile.h    -  nip         =           client.h    client-related actions  

                            =           data.h      handle collected data   

                            =           contact.h   contact the 3ppq team   
----------------------------------------------------------------------------
contact.h    -  nip         =           client.h    client-related actions  

                            =           profile.h   change own data         

                            =           data.h      handle collected data   
----------------------------------------------------------------------------
data.h       -  nip         =           client.h    client-related actions  

                            =           profile.h   change own data

                            =           contact.h   contact the 3ppq team   
----------------------------------------------------------------------------
newClient    -  nip,        nip         clexists.h  client exists, try again
                client-data             

                            nip         client.h                
----------------------------------------------------------------------------
clexists.h   -  nip         =           client.h    
============================================================================


Client FSA:
===========
============================================================================
                      CGI-vars          
function/       --------------------
html        OK  received    produced    next        descr
----------------------------------------------------------------------------
/client      -   -          login1,     verify      client logs in
                            login2
----------------------------------------------------------------------------
verify       -  login1,     -           /noclient   login codes unkown
                login2       

                            =           others.h    provide e-mail for others

                            =,          instruct.h  provide instruction
                            variables,
----------------------------------------------------------------------------
others.h     -  login1,     =,          others      store e-mail
                login2,     3 x e-mail
----------------------------------------------------------------------------
others       -  login1,     login1,     instruct.h  provide instruction
                login2,     login2,     (e-mail ignored if already specified)
                3 x e-mail  
----------------------------------------------------------------------------
instruct.h   -  login1,     =,          quest       present questions
                login2,     nr,data,
                variables,            
                            
----------------------------------------------------------------------------
quest        -  login1,     =           quest.h
                login2      
                variables,  
                nr,data     

                            =           complete.h
----------------------------------------------------------------------------
quest.h      -  login1,     =           quest
                login2      
                variables,  
                nr,data     
----------------------------------------------------------------------------
complete.h   -  login1,     =           quest
                login2      
                variables,  
                nr,data     

                            =           thanks
----------------------------------------------------------------------------
thanks       -  login1,     -           /home
                login2    
                variables,
                nr,data   
----------------------------------------------------------------------------
/noclient    -  -           -           /client     try again
                                        /home
============================================================================








